---
config:
  layout: elk
  theme: default
---
flowchart TB
 subgraph subGraph0["Transformaciones y Reglas de Negocio"]
        F1("Eliminar Duplicados y Formatear Fecha")
        F{"transform_data: Iniciar Transformaciones"}
        F2("date_filter: Filtrar por Rango de Fechas")
        F3("country_filter: Filtrar por País")
        F4("delivery_filter: Filtrar por Tipo de Entrega")
        F5("derived_cols: Crear Col. de Indicador")
        F6("fix_nulls: Rellenar Valores Nulos")
        F7("treatment_units: Estandarizar Unidades y Precios")
        F8("Calcular Columna Total")
        F9("rename_and_order_cols: Renombrar y Ordenar Columnas")
  end
    A["INICIO"] --> B("Cargar config.yaml")
    B --> C{"setup_environment: Iniciar Sesión Spark"}
    C --> D{"read_data: Cargar Data y Capturar Nombre de Archivo"}
    D --> E{"data_quality_input: Validar DQ de ENTRADA"}
    E -- FALLO --> Z("ERROR: Detener Pipeline")
    E -- APROBADO --> F
    F --> F1
    F1 --> F2
    F2 --> F3
    F3 --> F4
    F4 --> F5
    F5 --> F6
    F6 --> F7
    F7 --> F8
    F8 --> F9
    F9 --> G{"data_quality_output: Validar DQ de SALIDA"}
    G -- APROBADO --> H{"write_data: Escribir Data Particionada Parquet"}
    G -- FALLO --> Z
    H --> I("FIN: Detener Sesión Spark")